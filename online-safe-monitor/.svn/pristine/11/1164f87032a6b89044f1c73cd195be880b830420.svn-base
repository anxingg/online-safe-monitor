$(document).ready(function(){
	
	initSelect("safeProductType","bzhdj");
	initSelect("importCertificate","zmmc");
	initSelect("productType","sczk");
	
	
	//处理下拉选
	var hibzhdj = $("#hibzhdj").val();
	$("#bzhdj").val(hibzhdj);
	
	var hizmmc = $("#hizmmc").val();
	$("#zmmc").val(hizmmc);
	
	var hizyq = $("#hizyq").val();
	$("#zyq").val(hizyq);
	
	var hiqygm = $("#hiqygm").val();
	$("#qygm").val(hiqygm);
	
	var hisczk = $("#hisczk").val();
	$("#sczk").val(hisczk);
	
	//处理复选框
	var hihylx = $("#hihylx").val();
	if(hihylx!=null && hihylx!=""){
		var check = hihylx.split(',');
		for (var i = 0; i < check.length; i++) {
			$("input[name='hylx']").each(function(){
				if($(this).val()==check[i]){
					$(this).attr("checked",true);
				}
			});
		}
	}
	
	var hidwsb = $("#hidwsb").val();
	if(hidwsb!=null && hidwsb!=""){
		var check = hidwsb.split(',');
		for (var i = 0; i < check.length; i++) {
			$("input[name='dwsb']").each(function(){
				if($(this).val()==check[i]){
					$(this).attr("checked",true);
				}
			});
		}
	}
	
	
	
	
	//经济类型
	$("#jjlx").change(function(){
		selectJJLX();
	});
	var jjlx = $("#jjlx").val();
	if(jjlx == -1){
		$("#jjlxfl").hide();
	}
	var economicType = $("#economicType").val().split(",");
	if(economicType[0]!=""){
		$("#jjlx").find("option[value='"+economicType[0]+"']").attr("selected",true);
		selectJJLX();
		if(economicType[0] == "私营经济" || economicType[0] == "个体经济" || economicType[0] == "股份制" || economicType[0] == "外商投资" || economicType[0] == "港澳台投资"){
			 $("#jjlxfl").find("option[value='"+economicType[1]+"']").attr("selected",true);
		 }
	}

	//保存企业信息
	$("#submit").click(function(){
		// 框架校验
		if (!validator(document.getElementById("form1"))) {
			return;
		}
		var sczk = $.trim($("#sczk").val());
		if(sczk==null || sczk=="" || sczk==-1){
			artDialog.alert("请选择生产状况！");
			return;
		}
		art.dialog.confirm('确定要保存修改吗？', function() {
			submit();
		}, function() {
			return;
		});
	});
	
});


//经济类型选择
function selectJJLX(){
	
	var jjlx = $("#jjlx").val();
	if(jjlx == -1){
		$("#jjlxfl").html("");
		$("#jjlxfl").hide();
	}
	if(jjlx == "国有经济"){
		$("#jjlxfl").html("");
		$("#jjlxfl").hide();
	}
	if(jjlx == "集体经济"){
		$("#jjlxfl").html("");
		$("#jjlxfl").hide();
	}
	if(jjlx == "私营经济"){
		$("#jjlxfl").show();
		var str ='<option value="私营独资企业">私营独资企业</option>';
		str +='<option value="私营合伙企业">私营合伙企业</option>';
		str +='<option value="私营有限责任公司">私营有限责任公司</option>';
		$("#jjlxfl").html(str);
	}
	if(jjlx == "个体经济"){
		$("#jjlxfl").show();
		var str ='<option value="个体工商户">个体工商户</option>';
		str +='<option value="个人合伙">个人合伙</option>';
		$("#jjlxfl").html(str);
	}
	if(jjlx == "联营经济"){
		$("#jjlxfl").html("");
		$("#jjlxfl").hide();
	}
	if(jjlx == "股份制"){
		$("#jjlxfl").show();
		var str ='<option value="股份有限公司">股份有限公司</option>';
		str +='<option value="有限责任公司">有限责任公司</option>';
		$("#jjlxfl").html(str);
	}
	if(jjlx == "外商投资"){
		$("#jjlxfl").show();
		var str ='<option value="中外合资经营企业">中外合资经营企业</option>';
		str +='<option value="中外合作经营企业">中外合作经营企业</option>';
		str +='<option value="外资企业">外资企业</option>';
		$("#jjlxfl").html(str);
	}
	if(jjlx == "港澳台投资"){
		$("#jjlxfl").show();
		var str ='<option value="合资经营企业">合资经营企业</option>';
		str +='<option value="合作经营企业">合作经营企业</option>';
		str +='<option value="独资企业">独资企业</option>';
		$("#jjlxfl").html(str);
	}
	if(jjlx == "其它经济"){
		$("#jjlxfl").html("");
		$("#jjlxfl").hide();
	}
	
	
}



/**
 * 保存企业信息
 */
function submit(){
	
	var gszcdz = $.trim($("#gszcdz").val());

	
	var dwdm = $.trim($("#dwdm").val());

	var ssx = $.trim($("#ssx").val());

	
	var dwxz = $.trim($("#dwxz").val());//公司性质
	
	var clsj = $.trim($("#clsj").val());//成立时间
	clsj = clsj+" 00:00:00";
	
	var yyzzch = $.trim($("#yyzzch").val());
	
	var yyzzscfw = $.trim($("#yyzzscfw").val());
	
	var fdr = $.trim($("#fdr").val());
	
	
	var zzjgdm = $.trim($("#zzjgdm").val());
	//生成场所地址
	var sccsdz = $.trim($("#sccsdz").val());

	var qywz = $.trim($("#qywz").val());
	var yzbm = $.trim($("#yzbm").val());
	
	
	
	//经纬度
	var jd = $.trim($("#jd").val());
	var wd = $.trim($("#wd").val());

	//销售收入
	var xssr = $.trim($("#xssr").val());

	//职工人数
	var jgrs = $.trim($("#jgrs").val());
	
	//企业规模
	var qygm = $.trim($("#qygm").val());

	//是否在工业园区
	var zyq = $.trim($("#zyq").val());
	
	
	//安全生产管理人员人数
	var acscrs = $.trim($("#acscrs").val());

	//安全生产负责人
	var acscfzr = $.trim($("#acscfzr").val());

	//安全生产负责人移动电话
	var acscyddh = $.trim($("#acscyddh").val());

	//安全生产负责人办公电话
	var acscbgdh = $.trim($("#acscbgdh").val());

	//安全生产负责人电子邮箱
	var acscdzyx = $.trim($("#acscdzyx").val());
	
	//特种作业人员人数
	var tzzyrs = $.trim($("#tzzyrs").val());

	//安全生产标准等级
	var bzhdj = $.trim($("#bzhdj").val());

	//应急咨询服务号码
	var zxhm = $.trim($("#zxhm").val());

	//安全值班电话
	var zbdh = $.trim($("#zbdh").val());
	
	//进口企业资质证明名称
	var zmmc = $.trim($("#zmmc").val());
	//进口企业资质证明编号
	
	var zzbh = $.trim($("#zzbh").val());
	
	//主要产品及生产规模
	var zycp = $.trim($("#zycp").val());
	
	//企业简介
	var qyjj = $.trim($("#qyjj").val());
	
	//厂区边界外1000米范围内的单位或设备情况
	var dwsbStr="";
	$('input[name="dwsb"]:checked').each(function(){ 
		dwsbStr+=$(this).val()+",";
	});
	
	//企业分类
	var hylx = "";
	$('input[name="hylx"]:checked').each(function(){ 
		hylx+=$(this).val()+",";
	});
	
	//经济类型
	var jjlx = $("#jjlx").val();
	if(jjlx == "私营经济" || jjlx == "个体经济" || jjlx == "股份制" || jjlx == "外商投资" || jjlx == "港澳台投资"){
		jjlx = jjlx + "," + $("#jjlxfl").val();
	}
	
	//生产状况
	var sczk = $.trim($("#sczk").val());
	
	//生产投入提取标准
	var extractDescription = $.trim($("#extractDescription").val());
	var parmas = {
		"cpy.registrationAddress" : gszcdz,
			"cpy.companyCode" : dwdm,
			"cpy.cityId" : ssx,
			"cpy.companyProperty" : dwxz,
			"cpy.businessLicence" : yyzzch,
			"cpy.productionScope" : yyzzscfw,
			"cpy.legalRepresentative" : fdr,
			"cpy.economicType" : jjlx,
			"cpy.unitCode" : zzjgdm,
			"cpy.productAddress" : sccsdz,
			"cpy.website" : qywz,
			"cpy.productType" : sczk,
			"cpy.postalcode" : yzbm,
			"cpy.precision" : jd,
			"cpy.dimension" : wd,
			"cpy.sales" : xssr,
			"cpy.enterpriseScale" : qygm,
			"cpy.isIn" : zyq,
			"cpy.safeManageUserNum" : acscrs,
			"cpy.safeManageUserName" : acscfzr,
			"cpy.safeManageUserPhone" : acscyddh,
			"cpy.safeManageUserTel" : acscbgdh,
			"cpy.safeManageUserEmail" : acscdzyx,
			"cpy.specialUserNum" : tzzyrs,
			"cpy.safeProductGrade" : bzhdj,
			"cpy.emergencyPhone" : zxhm,
			"cpy.safeDutyPhone" : zbdh,
			"cpy.importCompanyQualificationNum" : zzbh,
			"cpy.importCompanyQualification" : zmmc,
			"cpy.product" : zycp,
			"cpy.introduction" : qyjj,
			"cpy.workersNum" : jgrs,
			//"cpy.establishmentTime" : clsj,
			"cpy.outsideSituation" : dwsbStr,
			"cpy.industryClassification" : hylx,
			"cpy.extractDescription" : extractDescription,
			"establishmentTime":clsj
	};
	
	$(".formButton_green").attr("disabled", "disabled");
	$.ajax({
		url : basePath + "companywh/saveOrUpdateCpy.action",
		type : "post",
		data : parmas,
		success : function(data){
			if (data == 1) {
				//artDialog.alert("修改成功！");
				window.location.href = basePath+"companywh/toCompanyView.action";
			}else{
				artDialog.alert("修改失败！");
				$(".formButton_green").removeAttr("disabled");
			}
		}
	});
	
	
	
	
	
}

/**
 * 初始化数据字段下拉框
 * @return
 */
function initSelect(typeName,id) {
	var paramData = {
		'infoType' : typeName,
		'sysTag' : 1
	};
	qytx.app.ajax({
		url : basePath + "dict/getDicts.action",
		type : "post",
		dataType : "text",
		data : paramData,
		success : function(data) {
			//data是一个数组
			var jsonData = eval('(' + data + ')');
			$("#"+id).empty();
			$("#"+id).append('<option value="-1">请选择</option>');
			for (var i = 0; i < jsonData.length; i++) {
				$("#"+id).append("<option value='"
						+ jsonData[i].value + "'>" + jsonData[i].name
						+ "</option>");
			}
		}
	});
}



